---
title: "Nextjs + Handlebars + Nodemailer untuk kirim email dengan template"
dateString: "Feb 11, 2022"
mainImageUrl: "/image/thumbnail-02.png"
altImage: "Handlebars, Nodemailer dan Nextjs"
excerpt: "Di tutorial ini saya akan menjelaskan bagaimana caranya membuat email template dengan Next.js dan Handlebars"
longtimeRead: 6
tags: ["Tutorial", "Nodejs"]
---

Terakhir kali saya ingin membuat email template dengan Next.js dan Handlebars dan mencari berbagai referensi
di internet. Tetapi hampir semua tutorial menggunakan Bahasa Inggris tentunya xixixi ğŸ˜…. Dan kepikiran untuk buat
versinya menggunakan Bahasa Indonesia.

Nah pada kali ini saya ingin membuat tutorial ini dengan bahasa Indonesia.
Gimana sih caranya kirim email menggunakan template bagus? Ini cocok untuk kamu yang ingin pasang contact form yang
ada di web kamu dan mendapatkan pesan dari pengunjung yang mengunjugi web kamu tentunya, atau ingin mengirim
email verification user register dari app yang kamu buat

Bahan yang kamu perlu adalah :

- Nodejs
- Handlebars
- Nodemailer
- Dan Nextjs untuk web framework yang digunakan

Kenapa saya menggunakan Nextjs? Karena di Nextjs disediakan fitur untuk api route
dengan Nodejs dan digabungkan dengan vercel sebagai server hostnya.
Kalian bisa pakai framework lain untuk membuat custom api route sendiri.

## 1. Buat repository baru

yang paling penting adalah kalian harus buat repository yang ingin kalian gunakanğŸ˜.
buat repo nextjs menggunakan [Create-Next-App](https://nextjs.org/docs/api-reference/create-next-app)
Disini saya pakai typescript kalian bisa pakai bash ini kalau ingin menggunakan typescript
`yarn create next-app --typescript`

lalu buka folder `pages/api` dan buat file `verification.ts`
dan jangan lupa install semua dependencies yang saya sebutkan diatas :

```bash
yarn add nodemailer handlebars -S
```

dan devdependencies nya :

```bash
yarn add @types/nodemailer -D -S
```

struktur folder akan terlihat seperti ini

```text
--pages
  --api
    --verification.ts
```

## 2. Waktunya Ngoding ğŸ‘¨â€ğŸ’»

`import` semua modul yang kita install tadi dan modul lainnya yang sudah terinstall secara `default`

```ts
import { NextApiRequest, NextApiResponse } from "next";
import nodemailer from "nodemailer";
import handlebars from "handlebars";
import fs from "fs";
import path from "path";
```

disini kita pakai module `fs` dan `path` untuk membaca file dari handlebars yang akan kita buat baik secara local development
ataupun pas ketika kita deploying ke server. Nanti saya akan menggunakan vercel untuk web hosting yang akan saya gunakan.

lalu kita buat variable function server yang akan kita gunakan untuk mengirim email.
tetapi sebelum itu kita buat panggil dulu file handlebars yang akan kita pakai sebagai template email
lihat code dibawah ini

```ts
const server = async (req: NextApiRequest, res: NextApiResponse) => {
  const { email, username } = req.body;

  const configDirectory = path.resolve(process.cwd(), "views");
  const files = fs
    .readFileSync(path.join(configDirectory, "verification.hbs"), "utf-8")
    .toString();

  const templates = handlebars.compile(files);
  const replacement = {
    email: username,
    actions: `${process.env.NEXT_PUBLIC_API_URL}/auth/signup/flow/show?email=${email}`,
  };
  const htmlToSend = templates(replacement);
};
```

Okey saya jelaskan code diatas untuk const `{email, message} = req.body` itu artinya kita akan mengambil data dari body
request yang dikirimkan dari user.

Lalu selanjutnya pada baris `const configDirectory = path.resolve(process.cwd(), "views");` itu artinya kita menggunakan
`path` untuk mencari file handlebars yang akan kita pakai sebagai template email. Dan kita juga menggunakan `fs` untuk
membaca file handlebars yang akan kita pakai sebagai template email di satu variable `files` dan diconvert atau dicompile
menjadi string. Lalu kita bisa panggil untuk melihat isinya bisa dipasang ke `res.status` ataupun `console`
dan `replacement` adalah variable dinamis yang kita buat menggunakan handlebars.

## 3. Buat template email

Nah distep ini kita bisa langsung membuat template email yang akan kita pakai untuk mengirim email tentunya menggunakan handlebars ğŸ‘¨ğŸ½â€ğŸ¦³.
Kalian bisa pakai template lainnya yang bisa kalian buat sendiri pakai HTML ataupun CSS.
Tapi disini saya menggunakan template [ini](https://github.com/leemunroe/responsive-html-email-template)
kalian bisa membuat emailnya dengan format `verification.hbs` atau `verification.handlebars` keduanya sama aja.

### 4. Buat transporter email menggunakan nodemailer

```ts
// transporter for api nodemailer with gmail smtp
const transporter = nodemailer.createTransport({
  host: "smtp.gmail.com",
  port: 465,
  secure: true,
  auth: {
    user: process.env.GOOGLE_MAIL,
    pass: process.env.GOOGLE_PASS,
  },
});
```

disini saya pakai env untuk mengambil data dari environment variable dan menggunakan host gmail
hehe karena belum mampu beli email custom domain, dan isi dari `process.env.GOOGLE_MAIL` dan `process.env.GOOGLE_PASS` adalah email dan password gmail kalian.
Bisa pakai email custom untuk bot yang akan memberi tahu ke user yang telah registrasi ke app yang kalian buat.

dan selanjutnya kita bisa langsung pakai method try and catch untuk mengeksekusi kode diatas yang kita buat diatas.

```ts
try {
  const sendMsg = await transporter.sendMail({
    from: "noreply@meraki.dev",
    to: email,
    subject: `Verified your accounts`,
    html: htmlToSend,
  });

  console.log("message sent", sendMsg.messageId);
} catch (err) {
  console.log(err);
}
```

disini kita eksekusi kalau ada data dari user melalui form registrasi dan kita akan mengirim email dari data form diclient ke user yang telah registrasi tersebut
dengan template yang kita buat custom tadi hehe. dan kalau sukses akan menampilkan `messageId` yang ada diatas dan pesan sukses.
Dan final code ketika semuanya digabung akan menjadi seperti ini

```ts
import { NextApiRequest, NextApiResponse } from "next";
import { withSentry } from "@sentry/nextjs";
import nodemailer from "nodemailer";
import handlebars from "handlebars";
import fs from "fs";
import path from "path";

const server = async (req: NextApiRequest, res: NextApiResponse) => {
  const { email, username, generateToken } = req.body;

  // read a template file (handlebars)
  // @reference
  // https://github.com/vercel/next.js/issues/8251

  const configDirectory = path.resolve(process.cwd(), "views");
  const files = fs
    .readFileSync(path.join(configDirectory, "verification.hbs"), "utf-8")
    .toString();

  const templates = handlebars.compile(files);
  const replacement = {
    email: username,
    actions: `${process.env.NEXT_PUBLIC_API_URL}/auth/signup/flow/show?email=${email}&t=${generateToken}`,
  };
  const htmlToSend = templates(replacement);

  // transporter for api nodemailer with gmail smtp
  const transporter = nodemailer.createTransport({
    host: "smtp.gmail.com",
    port: 465,
    secure: true,
    auth: {
      user: process.env.GOOGLE_MAIL,
      pass: process.env.GOOGLE_PASS,
    },
  });

  try {
    const sendMsg = await transporter.sendMail({
      from: "noreply@meraki.dev",
      to: email,
      subject: `Verified your accounts`,
      html: htmlToSend,
    });

    console.log("message sent", sendMsg.messageId);
  } catch (err) {
    console.log(err);
  }

  res.status(200).json(req.body);
};

export default server;
```

## 5. Next step

Next stepnya apa? kalian bisa buat function menggunakan axios untuk mengirim email ke user yang telah registrasi.
bisa cari referensinya atau nanti mungkin akan saya coba buatkan tutorialnya. Untuk host ke vercel gimana bang?
nanti saya juga akan buatkan tutorial hosting ke vercel. Tunggu saja tutorialnya ya!

Okey itu saja mungkin penjelasan mengenai tutorial cara kirim email menggunakan template handlebars, nodemailer dan nextjs.
Tentu saja ini baru backendnya kwkwkwkwk ğŸ˜‚.

Bye bye ğŸ‘‹ğŸ½, jangan lupa ngodingğŸ‘¨â€ğŸ’» dan ngopiâ˜• untuk hari ini ğŸ˜
